
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cleaning &#8212; Stata 101 1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Motivation" href="Import.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Cleaning">
<h1>Cleaning<a class="headerlink" href="#Cleaning" title="Permalink to this headline">¶</a></h1>
<p>At this stage, we use the file we had saved in the input_data folder to create datetime variables,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">use</span> <span class="s">&quot;..\input_data\NYPD_Motor_Vehicle_Collisions&quot;</span>,clear
</pre></div>
</div>
</div>
<p>Notice that we used <code class="docutils literal notranslate"><span class="pre">..\</span></code> here again. When this jupyter notebook is opened, its current directory is in the “dofiles” folder. Therefore, we use the relative paths to “move” to the “input_data” to get the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">notes list</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

_dta:
  1.  &#34;Downloaded 9 Dec 2018 11:30:26&#34;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>%head
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>time</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>location</th>
      <th>onstreetname</th>
      <th>crossstreetname</th>
      <th>offstreetname</th>
      <th>numberofpersonsinjured</th>
      <th>numberofpersonskilled</th>
      <th>numberofpedestriansinjured</th>
      <th>numberofpedestrianskilled</th>
      <th>numberofcyclistinjured</th>
      <th>numberofcyclistkilled</th>
      <th>numberofmotoristinjured</th>
      <th>numberofmotoristkilled</th>
      <th>contributingfactorvehicle1</th>
      <th>contributingfactorvehicle2</th>
      <th>contributingfactorvehicle3</th>
      <th>contributingfactorvehicle4</th>
      <th>contributingfactorvehicle5</th>
      <th>uniquekey</th>
      <th>vehicletypecode1</th>
      <th>vehicletypecode2</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>11/16/2018</td>
      <td>0:10</td>
      <td>MANHATTAN</td>
      <td>10010</td>
      <td>40.742275</td>
      <td>-73.988914</td>
      <td>(40.742275, -73.988914)</td>
      <td>5 AVENUE</td>
      <td>BROADWAY</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021880</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11/16/2018</td>
      <td>0:40</td>
      <td>.</td>
      <td>.</td>
      <td>40.762718</td>
      <td>-73.728172</td>
      <td>(40.76272, -73.72817)</td>
      <td>LONG ISLAND EXPRESSWAY</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Pavement Slippery</td>
      <td>Pavement Slippery</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021727</td>
      <td>Sedan</td>
      <td>Pick-up Truck</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11/16/2018</td>
      <td>0:45</td>
      <td>BROOKLYN</td>
      <td>11211</td>
      <td>40.710197</td>
      <td>-73.958427</td>
      <td>(40.710197, -73.95843)</td>
      <td>BORINQUEN PLACE</td>
      <td>HAVEMEYER STREET</td>
      <td>.</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Driver Inattention/Distraction</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021791</td>
      <td>Taxi</td>
      <td>Taxi</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11/16/2018</td>
      <td>1:00</td>
      <td>BRONX</td>
      <td>10454</td>
      <td>40.803555</td>
      <td>-73.911842</td>
      <td>(40.803555, -73.91184)</td>
      <td>EAST 137 STREET</td>
      <td>WILLOW AVENUE</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Pavement Slippery</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021878</td>
      <td>Garbage or Refuse</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11/16/2018</td>
      <td>1:00</td>
      <td>BROOKLYN</td>
      <td>11221</td>
      <td>40.694923</td>
      <td>-73.915565</td>
      <td>(40.694923, -73.915565)</td>
      <td>WILSON AVENUE</td>
      <td>PALMETTO STREET</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Pavement Slippery</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021848</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>6</th>
      <td>11/16/2018</td>
      <td>1:20</td>
      <td>.</td>
      <td>.</td>
      <td>40.804699</td>
      <td>-73.91243</td>
      <td>(40.8047, -73.91243)</td>
      <td>EAST 138 STREET</td>
      <td>BRUCKNER BOULEVARD</td>
      <td>.</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021877</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>7</th>
      <td>11/16/2018</td>
      <td>1:41</td>
      <td>.</td>
      <td>.</td>
      <td>40.737682</td>
      <td>-73.852058</td>
      <td>(40.737682, -73.85206)</td>
      <td>108 STREET</td>
      <td>HORACE HARDING EXPRESSWAY</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Following Too Closely</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021798</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11/16/2018</td>
      <td>2:50</td>
      <td>BRONX</td>
      <td>10451</td>
      <td>40.819057</td>
      <td>-73.92923</td>
      <td>(40.819057, -73.92923)</td>
      <td>EAST 149 STREET</td>
      <td>GERARD AVENUE</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021864</td>
      <td>Taxi</td>
      <td>Taxi</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>9</th>
      <td>11/16/2018</td>
      <td>4:22</td>
      <td>.</td>
      <td>.</td>
      <td>40.811749</td>
      <td>-73.931442</td>
      <td>(40.81175, -73.93144)</td>
      <td>MAJOR DEEGAN EXPRESSWAY</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unsafe Speed</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>4021857</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11/16/2018</td>
      <td>5:30</td>
      <td>QUEENS</td>
      <td>11417</td>
      <td>40.678871</td>
      <td>-73.83419</td>
      <td>(40.67887, -73.83419)</td>
      <td>ROCKAWAY BOULEVARD</td>
      <td>CENTREVILLE AVENUE</td>
      <td>.</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>4021833</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="Re-order-variables">
<h2>Re-order variables<a class="headerlink" href="#Re-order-variables" title="Permalink to this headline">¶</a></h2>
<p>Personally, I prefer ID type variables to be in the first few columns of the dataset. We will use Stata’s <code class="docutils literal notranslate"><span class="pre">order</span></code> command to move the variable uniquekey to the first column.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">order</span>(uniquekey), before(date)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-date-time-variables">
<h2>Create date time variables<a class="headerlink" href="#Create-date-time-variables" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Preview the date variable (through <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">codebook</span></code>, <code class="docutils literal notranslate"><span class="pre">browse</span></code>(Data Editor))</li>
<li>Determine the format of the date variable<ul>
<li>Is it a string, int, float, etc</li>
</ul>
</li>
<li>Determine if it is in other types of date format (e.g.&nbsp;Excel’s date format)</li>
</ol>
<p>Using %head %tail %browse is a function of stata kernel. Please visit <a class="reference external" href="https://kylebarron.dev/stata_kernel/using_stata_kernel/magics/">https://kylebarron.dev/stata_kernel/using_stata_kernel/magics/</a> for more information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>%head date
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>6</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>7</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>9</th>
      <td>11/16/2018</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11/16/2018</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">list</span> date<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">4</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

     +------------+
     |       date |
     |------------|
  1. | 11/16/2018 |
  2. | 11/16/2018 |
  3. | 11/16/2018 |
  4. | 11/16/2018 |
     +------------+
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">codebook</span> date
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
date                                                                                                                                                                                                                                                       DATE
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  string (str105)

         unique values:  2,331                    missing &#34;&#34;:  0/1,386,003

              examples:  &#34;03/24/2015&#34;
                         &#34;06/08/2017&#34;
                         &#34;08/15/2015&#34;
                         &#34;10/20/2013&#34;

               warning:  variable has leading and embedded blanks
</pre></div></div>
</div>
<p>Now, we determine that the date variable is in a string format. We will use Stata’s HRF-to-SIF conversion functions in the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> command.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> date_SIF = <span class="nf">date</span>(date, <span class="s">&quot;MDY&quot;</span>),after(date)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1 missing value generated)
</pre></div></div>
</div>
<p>We know that the date is a string variable, and it is in HRF( Human readable form) in the form of Month/Day/Year. We tell Stata’s <code class="docutils literal notranslate"><span class="pre">date()</span></code> function that through the mask <code class="docutils literal notranslate"><span class="pre">&quot;MDY&quot;</span></code>. Then, I tell Stata to put date_SIF in the column after date.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">list</span> date_SIF<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">4</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

     +----------+
     | date_SIF |
     |----------|
  1. |    21504 |
  2. |    21504 |
  3. |    21504 |
  4. |    21504 |
     +----------+
</pre></div></div>
</div>
<p>The variable is in SIF(Stata internal form) now. So Stata understands it is a date. But in order for us to understand, we tell Stata to display this number in HRF through the <code class="docutils literal notranslate"><span class="pre">format</span></code> command. The date format is <code class="docutils literal notranslate"><span class="pre">%td</span></code> and the time format is <code class="docutils literal notranslate"><span class="pre">%tc</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">format</span> date_SIF <span class="n n-Format">%td</span>
</pre></div>
</div>
</div>
<p>We repeat this for time variable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> time_SIF = <span class="nf">clock</span>(time, <span class="s">&quot;hm&quot;</span>),after(time)<span class="k"></span>
<span class="k">format</span> time_SIF <span class="n n-Format">%tc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(1 missing value generated)

</pre></div></div>
</div>
</div>
<div class="section" id="Why-do-we-want-Stata-to-understand-dates-and-times?">
<h2>Why do we want Stata to understand dates and times?<a class="headerlink" href="#Why-do-we-want-Stata-to-understand-dates-and-times?" title="Permalink to this headline">¶</a></h2>
<p>Because it allows us to do so much more! - view summary statistics of the date (e.g.&nbsp;first date, last date) - create year and month variables - create dummies based on durations - create dummies based on boolean logic</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">sum</span> date_SIF,<span class="k"> format</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    date_SIF |  1,386,002   14oct2015    669.6435  01jul2012  16nov2018
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> year_SIF = <span class="nf">year</span>(date_SIF) <span class="c1">// Extract year from the date</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1 missing value generated)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> month_SIF = <span class="nf">month</span>(date_SIF) <span class="c1">// Extract month from the date</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1 missing value generated)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> special_period = (date_SIF <span class="o">&gt;=</span> <span class="nf">td</span>(14feb2014) <span class="o">&amp;</span> date_SIF <span class="o">&lt;=</span> <span class="nf">td</span>(14march2014))<span class="k"></span>
<span class="k">tab</span> special_period
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>



special_per |
        iod |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,370,768       98.90       98.90
          1 |     15,235        1.10      100.00
------------+-----------------------------------
      Total |  1,386,003      100.00
</pre></div></div>
</div>
<div class="section" id="Renaming-long-variable-names">
<h3>Renaming long variable names<a class="headerlink" href="#Renaming-long-variable-names" title="Permalink to this headline">¶</a></h3>
<p>This is entirely up to you. I prefer a shorter variable name, and use labels to store the longer and more descriptive name. Labeling is the more important thing to do when you begin this process of building an analytical dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">rename</span> numberofcyclistinjured cyclistinjured<span class="k"></span>
<span class="k">rename</span> numberofcyclistkilled cyclistkilled
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">label</span> variable cyclistinjured <span class="s">&quot;Number of cyclists injured&quot;</span><span class="k"></span>
<span class="k">label</span> variable cyclistkilled <span class="s">&quot;Number of cyclists killed&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Creating-dummies-from-long-strings">
<h3>Creating dummies from long strings<a class="headerlink" href="#Creating-dummies-from-long-strings" title="Permalink to this headline">¶</a></h3>
<p>I will show you several methods to finding keywords from string variables. For example, we want to create a variable to indicate if a collision occurred with a bicycle. - <code class="docutils literal notranslate"><span class="pre">strpos</span></code> - contains exact “string”</p>
<ol class="arabic simple">
<li>Explore the string variable that we want to extract information from.</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">tab</span> vehicletypecode1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                VEHICLE TYPE CODE 1 |      Freq.     Percent        Cum.
------------------------------------+-----------------------------------
                              (ceme |          1        0.00        0.00
                              15 Pa |          1        0.00        0.00
                              2 TON |          1        0.00        0.00
                         2 dr sedan |          6        0.00        0.00
                             3-Door |         30        0.00        0.00
                              315 e |          1        0.00        0.00
                                 3D |         32        0.00        0.01
                         4 dr sedan |        202        0.01        0.02
                               4DSD |          3        0.00        0.02
                              4whee |          1        0.00        0.02
                              99999 |          1        0.00        0.02
                              ABULA |          1        0.00        0.02
                              ACCES |          2        0.00        0.02
                                 AM |        292        0.02        0.04
                              AMABU |          1        0.00        0.04
                                AMB |          7        0.00        0.04
                               AMBU |          5        0.00        0.04
                              AMBUL |        111        0.01        0.05
                          AMBULANCE |      2,406        0.17        0.23
                              AMbul |          1        0.00        0.23
                              APORT |          1        0.00        0.23
                              APPOR |          1        0.00        0.23
                                 AR |         41        0.00        0.23
                              ARMOR |          1        0.00        0.23
                               ARMY |          1        0.00        0.23
                              Ambul |         20        0.00        0.23
                          Ambulance |        265        0.02        0.25
                      Armored Truck |         42        0.00        0.25
                                 BA |          6        0.00        0.25
                               BACK |          2        0.00        0.25
                              BACKH |          4        0.00        0.25
                              BED T |          1        0.00        0.25
                              BICYC |          1        0.00        0.25
                            BICYCLE |      5,567        0.40        0.66
                               BOAT |          1        0.00        0.66
                              BOBCA |          3        0.00        0.66
                                BOX |          1        0.00        0.66
                              BOX T |          5        0.00        0.66
                                 BR |         42        0.00        0.66
                                 BS |          2        0.00        0.66
                                 BU |      2,229        0.16        0.82
                              BULLD |          2        0.00        0.82
                                BUS |     14,057        1.02        1.85
                                BUs |          1        0.00        1.85
                              Backh |          1        0.00        1.85
                     Beverage Truck |         31        0.00        1.85
                               Bike |      1,912        0.14        1.99
                               Boom |          1        0.00        1.99
                                Box |          1        0.00        1.99
                          Box Truck |      2,676        0.19        2.18
                              Box t |          1        0.00        2.18
                              Bucke |          1        0.00        2.18
                   Bulk Agriculture |          4        0.00        2.18
                                Bus |      1,992        0.14        2.33
                              CABIN |          1        0.00        2.33
                               CAMP |          1        0.00        2.33
                              CARGO |          2        0.00        2.33
                               CART |          1        0.00        2.33
                                 CB |         89        0.01        2.34
                              CHERR |          1        0.00        2.34
                              CHEVY |          1        0.00        2.34
                                 CM |         41        0.00        2.34
                               CMIX |          1        0.00        2.34
                                 CO |          2        0.00        2.34
                                COM |          8        0.00        2.34
                              COM T |          1        0.00        2.34
                               COM. |          1        0.00        2.34
                               COMB |          1        0.00        2.34
                              COMME |         11        0.00        2.34
                              COMMM |          1        0.00        2.34
                              CONCR |          1        0.00        2.34
                              CONST |          1        0.00        2.34
                               CONV |        398        0.03        2.37
                              COUPE |          1        0.00        2.37
                              CRANE |          1        0.00        2.37
                              CUSHM |          1        0.00        2.37
                              Cargo |          1        0.00        2.37
                          Carry All |        178        0.01        2.38
                              Cat 9 |          1        0.00        2.38
                        Chassis Cab |         83        0.01        2.39
                               Cmix |          1        0.00        2.39
                              Comix |          1        0.00        2.39
                               Comm |          1        0.00        2.39
                              Comme |          1        0.00        2.39
                     Concrete Mixer |         67        0.00        2.39
                        Convertible |        428        0.03        2.42
                              DELIV |         14        0.00        2.43
                               DELV |          2        0.00        2.43
                              DEMA- |          1        0.00        2.43
                               DIRT |          1        0.00        2.43
                              DOT R |          1        0.00        2.43
                                 DP |        367        0.03        2.45
                                 DS |      1,006        0.07        2.53
                               DUMP |         17        0.00        2.53
                              DUMPT |          1        0.00        2.53
                              DUNBA |          1        0.00        2.53
                              Deliv |          1        0.00        2.53
                               Dump |        414        0.03        2.56
                              Dumps |          1        0.00        2.56
                              E BIK |          1        0.00        2.56
                              E ONE |          1        0.00        2.56
                              E SCO |          1        0.00        2.56
                              E-BIK |          4        0.00        2.56
                              E-Bik |          2        0.00        2.56
                              E-MOT |          1        0.00        2.56
                              E/BIK |          1        0.00        2.56
                              EBIKE |          2        0.00        2.56
                              ELECT |         15        0.00        2.56
                              EMRGN |          1        0.00        2.56
                              EMS A |          1        0.00        2.56
                              EMS H |          1        0.00        2.56
                                 EN |          2        0.00        2.56
                                EPO |          1        0.00        2.56
                              Elect |          3        0.00        2.56
Enclosed Body - Removable Enclosure |          2        0.00        2.56
                                 FB |        238        0.02        2.58
                              FD NY |          1        0.00        2.58
                              FD tr |          1        0.00        2.58
                               FDNY |         34        0.00        2.58
                              FED E |          2        0.00        2.58
                               FIRE |         25        0.00        2.58
                         FIRE TRUCK |        850        0.06        2.64
                              FIRET |         10        0.00        2.64
                               FLAT |          9        0.00        2.65
                              FLATB |          1        0.00        2.65
                               FORD |          4        0.00        2.65
                               FORK |          2        0.00        2.65
                              FORK- |          1        0.00        2.65
                              FORKL |         11        0.00        2.65
                                 FR |         34        0.00        2.65
                               FREE |          1        0.00        2.65
                              FREIG |          6        0.00        2.65
                              FRONT |          1        0.00        2.65
                              Fd fi |          1        0.00        2.65
                               Fdny |          2        0.00        2.65
                               Fire |         15        0.00        2.65
                              Firet |          1        0.00        2.65
                           Flat Bed |        226        0.02        2.67
                          Flat Rack |         51        0.00        2.67
                               Ford |          1        0.00        2.67
                              Forkl |          2        0.00        2.67
                              Freig |          1        0.00        2.67
                              GARBA |          4        0.00        2.67
                              GE/SC |          1        0.00        2.67
                                 GG |        205        0.01        2.69
                               GOLF |          1        0.00        2.69
                              GOVER |          1        0.00        2.69
                                 GR |          2        0.00        2.69
                               GRAY |          1        0.00        2.69
                              Garba |          2        0.00        2.69
                  Garbage or Refuse |        223        0.02        2.70
                         Glass Rack |          1        0.00        2.70
                               Golf |          2        0.00        2.70
                               H/WH |          1        0.00        2.70
                              HEAVY |          1        0.00        2.70
                               HELP |          1        0.00        2.70
                                 HO |          1        0.00        2.70
                              HORSE |          2        0.00        2.70
                              HWY C |          1        0.00        2.70
                               Hand |          1        0.00        2.70
                             Hopper |          3        0.00        2.70
                              Humme |          1        0.00        2.70
                                 IP |          1        0.00        2.70
                              Ice C |          1        0.00        2.71
                              Inter |          1        0.00        2.71
                               John |          1        0.00        2.71
     LARGE COM VEH(6 OR MORE TIRES) |     14,527        1.06        3.76
                                 LF |         16        0.00        3.76
                              LIBER |          1        0.00        3.76
                               LIMO |          3        0.00        3.76
                              LIVER |          2        0.00        3.76
                     LIVERY VEHICLE |     10,481        0.76        4.53
                                 LL |        169        0.01        4.54
                              LOADE |          1        0.00        4.54
                                 LP |          1        0.00        4.54
                                 LW |          2        0.00        4.54
                               Lift |          1        0.00        4.54
                          Lift Boom |         19        0.00        4.54
                              Light |          1        0.00        4.54
                              Limou |          1        0.00        4.54
                     Livestock Rack |          2        0.00        4.54
                                Log |          1        0.00        4.54
                        Lunch Wagon |          4        0.00        4.54
                               MACK |          2        0.00        4.54
                               MAIL |          4        0.00        4.54
                               MARK |          1        0.00        4.54
                                 MB |         20        0.00        4.54
                                 MD |         32        0.00        4.54
                                 MH |          3        0.00        4.54
                              MILLI |          1        0.00        4.54
                               MINI |          3        0.00        4.54
                                 MK |          1        0.00        4.54
                              MOPED |         10        0.00        4.55
                              MOTOR |          6        0.00        4.55
                         MOTORCYCLE |      6,536        0.48        5.02
                                 MS |         42        0.00        5.02
                              MTA B |          4        0.00        5.02
                              Marke |          1        0.00        5.02
                               Mini |          1        0.00        5.02
                           Minibike |          7        0.00        5.03
                          Minicycle |          4        0.00        5.03
                              Mo pa |          1        0.00        5.03
                              Moped |         56        0.00        5.03
                              Motor |          2        0.00        5.03
                          Motorbike |         41        0.00        5.03
                         Motorcycle |        877        0.06        5.10
                     Motorized Home |          4        0.00        5.10
                       Motorscooter |         62        0.00        5.10
              Multi-Wheeled Vehicle |         15        0.00        5.10
                                N/A |          1        0.00        5.10
                              NEW Y |          2        0.00        5.10
                              NS AM |          1        0.00        5.10
                              NYC B |          1        0.00        5.10
                              NYC M |          1        0.00        5.10
                              NYC a |          1        0.00        5.10
                               NYPD |          2        0.00        5.10
                              OIL T |          2        0.00        5.10
                                OML |          1        0.00        5.10
                              OMNIB |          1        0.00        5.10
                                OMR |          5        0.00        5.10
                                OMT |          2        0.00        5.10
                              OTHER |     23,972        1.74        6.85
                          Open Body |          5        0.00        6.85
                               P/SE |          1        0.00        6.85
                               P/SH |          2        0.00        6.85
                                PAS |          2        0.00        6.85
                  PASSENGER VEHICLE |    715,227       52.00       58.85
                              PEDIC |          1        0.00       58.85
                            PEDICAB |         35        0.00       58.85
                              PICK- |          1        0.00       58.85
                      PICK-UP TRUCK |     23,069        1.68       60.53
                              PICKU |          4        0.00       60.53
                                 PK |        405        0.03       60.56
                                 PL |          6        0.00       60.56
                                 PM |          7        0.00       60.56
                              POSTA |          4        0.00       60.56
                              POSTO |          1        0.00       60.56
                              POWER |          7        0.00       60.56
                                PSD |          4        0.00       60.56
                                PSR |          1        0.00       60.56
                               PUMP |          1        0.00       60.56
                             Pallet |          7        0.00       60.56
                            Pedicab |         11        0.00       60.56
                               Pick |          1        0.00       60.56
                              Pick- |          1        0.00       60.56
                      Pick-up Truck |      3,883        0.28       60.85
                              Picku |          1        0.00       60.85
         Pickup with mounted Camper |          5        0.00       60.85
                              Porta |          1        0.00       60.85
                                R/V |          1        0.00       60.85
                              R/V C |          1        0.00       60.85
                              REFRI |          3        0.00       60.85
                              RENTA |          1        0.00       60.85
                                REP |          2        0.00       60.85
                              RESCU |          1        0.00       60.85
                                 RF |         56        0.00       60.85
                                 RV |         11        0.00       60.85
                              RYDER |          1        0.00       60.85
                   Refrigerated Van |         58        0.00       60.86
                              SANIT |          6        0.00       60.86
                              SCHOO |         16        0.00       60.86
                              SCOOT |         10        0.00       60.86
                            SCOOTER |        256        0.02       60.88
                                 SE |          1        0.00       60.88
                               SELF |          4        0.00       60.88
                               SEMI |          2        0.00       60.88
                              SEMI- |          1        0.00       60.88
                              SKATE |          3        0.00       60.88
            SMALL COM VEH(4 TIRES)  |     14,559        1.06       61.94
                              SMART |          1        0.00       61.94
                               SNOW |          1        0.00       61.94
                                 SP |         20        0.00       61.94
                                SPC |          2        0.00       61.94
      SPORT UTILITY / STATION WAGON |    313,498       22.79       84.73
                              SPRIN |          1        0.00       84.73
                                 ST |         15        0.00       84.74
                              ST150 |          1        0.00       84.74
                               STAK |          5        0.00       84.74
                              STREE |          6        0.00       84.74
                              SUBN/ |          1        0.00       84.74
                              SUBUR |          1        0.00       84.74
                                SUV |          3        0.00       84.74
                              SWEEP |          1        0.00       84.74
                              Sanit |          1        0.00       84.74
                              Schoo |          1        0.00       84.74
                         School Bus |          9        0.00       84.74
                              Scoot |          1        0.00       84.74
                              Sedan |     56,607        4.12       88.85
                               Semi |          1        0.00       88.85
                              Semi- |          1        0.00       88.85
                              Skate |          1        0.00       88.85
                              Smart |          1        0.00       88.85
                          Snow Plow |          1        0.00       88.85
                                Spc |          1        0.00       88.85
                              Sprin |          2        0.00       88.85
                      Stake or Rack |         11        0.00       88.85
Station Wagon/Sport Utility Vehicle |     43,706        3.18       92.03
                               Subn |          1        0.00       92.03
                              Sweep |          1        0.00       92.03
                               TANK |          2        0.00       92.03
                              TANKE |          2        0.00       92.03
                               TAXI |     50,669        3.68       95.72
                                 TK |      2,485        0.18       95.90
                                 TN |         77        0.01       95.90
                                TOW |          3        0.00       95.90
                              TOW T |         13        0.00       95.90
                              TOWTR |          2        0.00       95.90
                                 TR |        160        0.01       95.92
                               TRAC |          3        0.00       95.92
                              TRACK |          1        0.00       95.92
                              TRACT |         21        0.00       95.92
                              TRAFF |          1        0.00       95.92
                              TRAIL |         52        0.00       95.92
                              TRANS |          3        0.00       95.92
                                TRK |          2        0.00       95.92
                                TRL |          3        0.00       95.92
                              TRLPM |          1        0.00       95.92
                               TRLR |          2        0.00       95.92
                              TRUCK |         45        0.00       95.93
                                 TT |        130        0.01       95.94
                             Tanker |         76        0.01       95.94
                               Taxi |      5,894        0.43       96.37
                                Tow |          1        0.00       96.37
                              Tow T |          1        0.00       96.37
                          Tow Truck |          4        0.00       96.37
                Tow Truck / Wrecker |        125        0.01       96.38
                              Tow t |          1        0.00       96.38
                              Tow-t |          1        0.00       96.38
                              Tract |          3        0.00       96.38
               Tractor Truck Diesel |      1,175        0.09       96.46
             Tractor Truck Gasoline |        159        0.01       96.48
                              Trail |          5        0.00       96.48
                              Truck |          2        0.00       96.48
                               U.S. |          1        0.00       96.48
                              UHAUL |          4        0.00       96.48
                              UHUAL |          1        0.00       96.48
                                UKN |          1        0.00       96.48
                              UNKNO |          1        0.00       96.48
                            UNKNOWN |     19,929        1.45       97.93
                              UPS T |          1        0.00       97.93
                              UPS t |          1        0.00       97.93
                              US PO |          1        0.00       97.93
                               USPS |         16        0.00       97.93
                                 UT |          1        0.00       97.93
                               UTIL |          4        0.00       97.93
                              UTILI |          6        0.00       97.93
                                UTV |          1        0.00       97.93
                              Unkno |          1        0.00       97.93
                               Util |          1        0.00       97.93
                              Utili |          2        0.00       97.93
                                VAN |     26,540        1.93       99.86
                              VAN T |          1        0.00       99.86
                              VAN/T |          2        0.00       99.86
                               VANG |          1        0.00       99.86
                                 VC |          2        0.00       99.86
                                 VN |        712        0.05       99.91
                                 VT |          2        0.00       99.91
                                Van |        906        0.07       99.98
                         Van Camper |          4        0.00       99.98
                            Vanette |          1        0.00       99.98
                              Veriz |          1        0.00       99.98
                              WAGON |          1        0.00       99.98
                                 WD |          1        0.00       99.98
                               WHBL |          1        0.00       99.98
                              WHEEL |          1        0.00       99.98
                              WHITE |          1        0.00       99.98
                               WORK |          2        0.00       99.98
                              Wagon |          1        0.00       99.98
                       Well Driller |          1        0.00       99.98
                              Wheel |          1        0.00       99.98
                               Work |          1        0.00       99.98
                              YELLO |          2        0.00       99.98
                               ambu |          5        0.00       99.98
                              ambul |         21        0.00       99.98
                              armor |          1        0.00       99.98
                              box t |          7        0.00       99.98
                              bulld |          1        0.00       99.98
                                bus |          7        0.00       99.98
                              cargo |          1        0.00       99.98
                               cate |          1        0.00       99.98
                              cemen |          1        0.00       99.98
                              chevo |          1        0.00       99.98
                                com |          2        0.00       99.98
                              comme |          3        0.00       99.98
                              deliv |          3        0.00       99.98
                               delv |          3        0.00       99.98
                                 dp |          1        0.00       99.98
                               dsny |          1        0.00       99.98
                               dump |          5        0.00       99.98
                              e BIK |          1        0.00       99.98
                              e amb |          1        0.00       99.98
                              e com |          1        0.00       99.98
                              e sco |          1        0.00       99.98
                              e-bik |          2        0.00       99.98
                               east |          1        0.00       99.98
                              elect |          3        0.00       99.98
                               f550 |          1        0.00       99.98
                              fd tr |          1        0.00       99.98
                               fdny |          8        0.00       99.98
                               fire |         13        0.00       99.99
                              firet |          1        0.00       99.99
                               flat |          1        0.00       99.99
                              flatb |          1        0.00       99.99
                               ford |          2        0.00       99.99
                               fork |          1        0.00       99.99
                              forkl |          4        0.00       99.99
                              garba |          3        0.00       99.99
                              gator |          1        0.00       99.99
                              ice c |          1        0.00       99.99
                              icecr |          1        0.00       99.99
                              ladde |          1        0.00       99.99
                              light |          1        0.00       99.99
                               mail |          1        0.00       99.99
                                mcy |          1        0.00       99.99
                              mopad |          1        0.00       99.99
                              motor |          3        0.00       99.99
                                mta |          1        0.00       99.99
                              mta b |          2        0.00       99.99
                              nyc a |          1        0.00       99.99
                               omni |          1        0.00       99.99
                               p/sh |          1        0.00       99.99
                                pas |          1        0.00       99.99
                              passa |          1        0.00       99.99
                               pick |          4        0.00       99.99
                              posta |          2        0.00       99.99
                              power |          1        0.00       99.99
                               rd/s |          1        0.00       99.99
                               refg |          1        0.00       99.99
                                 rv |          2        0.00       99.99
                              sanit |          2        0.00       99.99
                              schoo |          7        0.00       99.99
                              sciss |          1        0.00       99.99
                              scoot |          2        0.00       99.99
                              seagr |          1        0.00       99.99
                               self |          1        0.00       99.99
                               semi |          2        0.00       99.99
                               sgws |          1        0.00       99.99
                              spc p |          1        0.00       99.99
                               spec |          1        0.00       99.99
                              stree |          1        0.00       99.99
                               subn |          3        0.00       99.99
                                 tk |          1        0.00       99.99
                                tow |          2        0.00       99.99
                              tow t |          3        0.00       99.99
                               trac |          1        0.00       99.99
                              tract |          6        0.00       99.99
                              trail |         17        0.00       99.99
                                trk |          1        0.00       99.99
                               trlr |          1        0.00       99.99
                              truck |          9        0.00       99.99
                              uhaul |          1        0.00       99.99
                              ulili |          1        0.00       99.99
                                unk |          3        0.00       99.99
                              unkno |          4        0.00       99.99
                              ups t |          1        0.00       99.99
                               usps |          2        0.00       99.99
                              utili |          6        0.00       99.99
                                van |         75        0.01      100.00
                              van t |          1        0.00      100.00
                                vol |          1        0.00      100.00
------------------------------------+-----------------------------------
                              Total |  1,375,333      100.00
</pre></div></div>
</div>
<ol class="arabic simple" start="2">
<li>Find some key words. E.g. BICYCLE, Bike</li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> bicyclerelated = vehicletypecode1 <span class="o">==</span> <span class="s">&quot;BICYCLE&quot;</span> | vehicletypecode1 <span class="o">==</span> <span class="s">&quot;Bike&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">tab</span> bicyclerelated
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

bicyclerela |
        ted |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,378,524       99.46       99.46
          1 |      7,479        0.54      100.00
------------+-----------------------------------
      Total |  1,386,003      100.00
</pre></div></div>
</div>
<p>The above method requires that vehicletypecode1 have exactly those characters within the double quotation marks. If “BICYCLE” were spelt in lower capitals, the command above will not capture it. Hence, we can “improve” upon the code by using <code class="docutils literal notranslate"><span class="pre">lower()</span></code> or <code class="docutils literal notranslate"><span class="pre">upper()</span></code> functions to ensure that the strings are in the right form.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> bicyclerelated_2 = <span class="nf">upper</span>(vehicletypecode1) <span class="o">==</span> <span class="s">&quot;BICYCLE&quot;</span> | <span class="nf">upper</span>(vehicletypecode1) <span class="o">==</span> <span class="s">&quot;BIKE&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">tab</span> bicyclerelated_2
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

bicyclerela |
      ted_2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,378,524       99.46       99.46
          1 |      7,479        0.54      100.00
------------+-----------------------------------
      Total |  1,386,003      100.00
</pre></div></div>
</div>
<p>The method above is tedious because it requires that you look for every single keyword that is related to a bicycle. For example, in order to identify Minibike, you need to know that it exists in vehicletypecode1. We can use Stata’s <code class="docutils literal notranslate"><span class="pre">strpos</span></code> function to look within a string for a keyword. If the keyword exists in a string, <code class="docutils literal notranslate"><span class="pre">strpos</span></code> will return the position number. Hence, it enables us to detect</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">gen</span> bicyclerelated_3 = <span class="nf">strpos</span>(<span class="nf">upper</span>(vehicletypecode1), <span class="s">&quot;BICYCLE&quot;</span>) <span class="o">&gt;</span><span class="m">0</span> | <span class="nf">strpos</span>(<span class="nf">upper</span>(vehicletypecode1), <span class="s">&quot;BIKE&quot;</span>) <span class="o">&gt;</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">tab</span> bicyclerelated_3
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

bicyclerela |
      ted_3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,378,474       99.46       99.46
          1 |      7,529        0.54      100.00
------------+-----------------------------------
      Total |  1,386,003      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>screening, sources(vehicletypecode1, upper) explore(tab) keys(BICYCLE) letters(<span class="m">5</span>)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Cases of BICYC found in vehicletypecode1

                              BICYC |      Freq.     Percent        Cum.
------------------------------------+-----------------------------------
                            BICYCLE |      5,567       99.98       99.98
                              BICYC |          1        0.02      100.00
------------------------------------+-----------------------------------
                              Total |      5,568      100.00

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>screening, sources(vehicletypecode1, upper) explore(tab) keys(BIKE) letters(<span class="m">3</span>)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Cases of BIK found in vehicletypecode1

                                BIK |      Freq.     Percent        Cum.
------------------------------------+-----------------------------------
                               BIKE |      1,912       96.91       96.91
                          MOTORBIKE |         41        2.08       98.99
                              E-BIK |          8        0.41       99.39
                           MINIBIKE |          7        0.35       99.75
                              E BIK |          2        0.10       99.85
                              EBIKE |          2        0.10       99.95
                              E/BIK |          1        0.05      100.00
------------------------------------+-----------------------------------
                              Total |      1,973      100.00

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span><span class="k">tab</span> vehicletypecode1<span class="k"> if</span> <span class="nf">strpos</span>(<span class="nf">upper</span>(vehicletypecode1), <span class="s">&quot;BIKE&quot;</span>)<span class="o">&gt;</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                VEHICLE TYPE CODE 1 |      Freq.     Percent        Cum.
------------------------------------+-----------------------------------
                               Bike |      1,912       97.45       97.45
                              EBIKE |          2        0.10       97.55
                           Minibike |          7        0.36       97.91
                          Motorbike |         41        2.09      100.00
------------------------------------+-----------------------------------
                              Total |      1,962      100.00
</pre></div></div>
</div>
<p>You will notice that “Motorbike” is included in the list. This erroneously added 41 observations to bicyclerelated_3.</p>
<p>// Identify Bicycle related collisions gen bicyclerelated = /// vehicletypecode1 == “BICYCLE” | /// vehicletypecode2 == “BICYCLE” | /// vehicletypecode3 == “BICYCLE” | /// vehicletypecode4 == “BICYCLE” | /// vehicletypecode5 == “BICYCLE” | /// vehicletypecode1 == “PEDICAB” | /// vehicletypecode2 == “PEDICAB” | /// vehicletypecode3 == “PEDICAB” | /// vehicletypecode4 == “PEDICAB” | /// vehicletypecode5 == “PEDICAB”</p>
<p>// Explore the coodinates codebook latitude codebook longitude</p>
<p>// There are missing data in the latitude and longitude gen mi_latlong = mi(latitude) &amp; mi(longitude)</p>
<p>// Create year variable gen year = year(date)</p>
<p>// Explore the data tab mi_latlong year, column</p>
<p>// Fill in the missing Longditude and Latitude points</p>
<p>// Sort the data in order sort onstreetname crossstreetname</p>
<p>// If borough, zip, on street and cross street are the same // we use the latitude &amp; longitude for the missing</p>
<p>replace latitude = latitude[_n-1] if /// mi(latitude) &amp; /// (borough == borough[_n-1]) &amp; /// (zipcode == zipcode[_n-1]) &amp; /// (onstreetname == onstreetname[_n-1]) &amp; /// (crossstreetname == crossstreetname[_n-1])</p>
<p>replace longitude = longitude[_n-1] if /// mi(longitude) &amp; /// (borough == borough[_n-1]) &amp; /// (zipcode == zipcode[_n-1]) &amp; /// (onstreetname == onstreetname[_n-1]) &amp; /// (crossstreetname == crossstreetname[_n-1])</p>
<p>gen mi_latlong2 = mi(latitude) &amp; mi(longitude) tab mi_latlong2 year, column</p>
<p>// Decision to make // Do we drop observations that do not have coordinates, or geocode them through // other means?</p>
<p>// Drop observations which are still missing drop if mi_latlong2 == 1</p>
<p>// Out of boundaries drop if longitude &lt; -74.5 | longitude &gt; -73 drop if latitude &lt; 40 | latitude &gt; 41</p>
<p>// Lets visualize the collisions twoway scatter latitude longitude, msymbol(o) msize(tiny) graph close</p>
<p>// Create unique ID for unique longitude and latitude egen ID = group( latitude longitude)</p>
<p>// Which intersections have the most collisions?</p>
<p>// Which intersections have the most collisions in 2013?</p>
<p>// Export for QGIS maping export delimited using “..:nbsphinx-math:<cite>working</cite>_data:nbsphinx-math:<cite>NYPD</cite>_Motor_Vehicle_Collisions_clean.csv”, replace</p>
<p>// Lets map the collisions out in QGIS</p>
<p>display “$S_DATE $S_TIME” notes: “Cleaned $S_DATE $S_TIME” notes list save “..:nbsphinx-math:<cite>working</cite>_data:nbsphinx-math:<cite>NYPD</cite>_Motor_Vehicle_Collisions_clean.dta”,replace</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-stata notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Stata 101</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html#User-written-files">User written files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html#About-SSC">About SSC</a></li>
<li class="toctree-l1"><a class="reference internal" href="Import.html">Motivation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cleaning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Re-order-variables">Re-order variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Create-date-time-variables">Create date time variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Why-do-we-want-Stata-to-understand-dates-and-times?">Why do we want Stata to understand dates and times?</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Import.html" title="previous chapter">Motivation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Jeremy J. Sze; Jaison Moreno; Omari-Khalid Rahman; Mohammed Husain.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Cleaning.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
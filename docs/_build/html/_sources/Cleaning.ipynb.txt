{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Cleaning\n",
    "\n",
    "At this stage, we use the file we had saved in the input_data folder to create datetime variables, "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "use \"..\\input_data\\NYPD_Motor_Vehicle_Collisions\",clear"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we used `..\\` here again. When this jupyter notebook is opened, its current directory is in the \"dofiles\" folder. Therefore, we use the relative paths to \"move\" to the \"input_data\" to get the dataset."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "_dta:\n",
      "  1.  \"Downloaded 9 Dec 2018 11:30:26\"\n"
     ]
    }
   ],
   "source": [
    "notes list"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>time</th>\n",
       "      <th>borough</th>\n",
       "      <th>zipcode</th>\n",
       "      <th>latitude</th>\n",
       "      <th>longitude</th>\n",
       "      <th>location</th>\n",
       "      <th>onstreetname</th>\n",
       "      <th>crossstreetname</th>\n",
       "      <th>offstreetname</th>\n",
       "      <th>numberofpersonsinjured</th>\n",
       "      <th>numberofpersonskilled</th>\n",
       "      <th>numberofpedestriansinjured</th>\n",
       "      <th>numberofpedestrianskilled</th>\n",
       "      <th>numberofcyclistinjured</th>\n",
       "      <th>numberofcyclistkilled</th>\n",
       "      <th>numberofmotoristinjured</th>\n",
       "      <th>numberofmotoristkilled</th>\n",
       "      <th>contributingfactorvehicle1</th>\n",
       "      <th>contributingfactorvehicle2</th>\n",
       "      <th>contributingfactorvehicle3</th>\n",
       "      <th>contributingfactorvehicle4</th>\n",
       "      <th>contributingfactorvehicle5</th>\n",
       "      <th>uniquekey</th>\n",
       "      <th>vehicletypecode1</th>\n",
       "      <th>vehicletypecode2</th>\n",
       "      <th>vehicletypecode3</th>\n",
       "      <th>vehicletypecode4</th>\n",
       "      <th>vehicletypecode5</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>0:10</td>\n",
       "      <td>MANHATTAN</td>\n",
       "      <td>10010</td>\n",
       "      <td>40.742275</td>\n",
       "      <td>-73.988914</td>\n",
       "      <td>(40.742275, -73.988914)</td>\n",
       "      <td>5 AVENUE</td>\n",
       "      <td>BROADWAY</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021880</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>0:40</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>40.762718</td>\n",
       "      <td>-73.728172</td>\n",
       "      <td>(40.76272, -73.72817)</td>\n",
       "      <td>LONG ISLAND EXPRESSWAY</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Pavement Slippery</td>\n",
       "      <td>Pavement Slippery</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021727</td>\n",
       "      <td>Sedan</td>\n",
       "      <td>Pick-up Truck</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>0:45</td>\n",
       "      <td>BROOKLYN</td>\n",
       "      <td>11211</td>\n",
       "      <td>40.710197</td>\n",
       "      <td>-73.958427</td>\n",
       "      <td>(40.710197, -73.95843)</td>\n",
       "      <td>BORINQUEN PLACE</td>\n",
       "      <td>HAVEMEYER STREET</td>\n",
       "      <td>.</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>Driver Inattention/Distraction</td>\n",
       "      <td>Driver Inattention/Distraction</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021791</td>\n",
       "      <td>Taxi</td>\n",
       "      <td>Taxi</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>1:00</td>\n",
       "      <td>BRONX</td>\n",
       "      <td>10454</td>\n",
       "      <td>40.803555</td>\n",
       "      <td>-73.911842</td>\n",
       "      <td>(40.803555, -73.91184)</td>\n",
       "      <td>EAST 137 STREET</td>\n",
       "      <td>WILLOW AVENUE</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Pavement Slippery</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021878</td>\n",
       "      <td>Garbage or Refuse</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>1:00</td>\n",
       "      <td>BROOKLYN</td>\n",
       "      <td>11221</td>\n",
       "      <td>40.694923</td>\n",
       "      <td>-73.915565</td>\n",
       "      <td>(40.694923, -73.915565)</td>\n",
       "      <td>WILSON AVENUE</td>\n",
       "      <td>PALMETTO STREET</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Pavement Slippery</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021848</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>1:20</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>40.804699</td>\n",
       "      <td>-73.91243</td>\n",
       "      <td>(40.8047, -73.91243)</td>\n",
       "      <td>EAST 138 STREET</td>\n",
       "      <td>BRUCKNER BOULEVARD</td>\n",
       "      <td>.</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021877</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>1:41</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>40.737682</td>\n",
       "      <td>-73.852058</td>\n",
       "      <td>(40.737682, -73.85206)</td>\n",
       "      <td>108 STREET</td>\n",
       "      <td>HORACE HARDING EXPRESSWAY</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Following Too Closely</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021798</td>\n",
       "      <td>Sedan</td>\n",
       "      <td>Sedan</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>2:50</td>\n",
       "      <td>BRONX</td>\n",
       "      <td>10451</td>\n",
       "      <td>40.819057</td>\n",
       "      <td>-73.92923</td>\n",
       "      <td>(40.819057, -73.92923)</td>\n",
       "      <td>EAST 149 STREET</td>\n",
       "      <td>GERARD AVENUE</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Driver Inattention/Distraction</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021864</td>\n",
       "      <td>Taxi</td>\n",
       "      <td>Taxi</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>4:22</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>40.811749</td>\n",
       "      <td>-73.931442</td>\n",
       "      <td>(40.81175, -73.93144)</td>\n",
       "      <td>MAJOR DEEGAN EXPRESSWAY</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Unsafe Speed</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>Unspecified</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021857</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>Station Wagon/Sport Utility Vehicle</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>11/16/2018</td>\n",
       "      <td>5:30</td>\n",
       "      <td>QUEENS</td>\n",
       "      <td>11417</td>\n",
       "      <td>40.678871</td>\n",
       "      <td>-73.83419</td>\n",
       "      <td>(40.67887, -73.83419)</td>\n",
       "      <td>ROCKAWAY BOULEVARD</td>\n",
       "      <td>CENTREVILLE AVENUE</td>\n",
       "      <td>.</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Driver Inattention/Distraction</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>4021833</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "      <td>.</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  1. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 0:10 | MANHATTAN |   10010 | 40.74228 | -73.98891 | (40.742275, -73.988914) | 5 AVENUE                         |                  BROADWAY |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |                    Unspecified |                    Unspecified |              |           |           |  4021880  | Station Wagon/Sport Utility Vehicle  | Station Wagon/Sport Utility Vehicle  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  2. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 0:40 |           |         | 40.76272 | -73.72817 |   (40.76272, -73.72817) | LONG ISLAND EXPRESSWAY           |                           |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |              Pavement Slippery |              Pavement Slippery |              |           |           |  4021727  |                               Sedan  |                       Pick-up Truck  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  3. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 0:45 |  BROOKLYN |   11211 |  40.7102 | -73.95843 |  (40.710197, -73.95843) | BORINQUEN PLACE                  |          HAVEMEYER STREET |          |        4 |        0 |        0 |        0 |        0 |        0 |        4 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 | Driver Inattention/Distraction | Driver Inattention/Distraction |              |           |           |  4021791  |                                Taxi  |                                Taxi  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  4. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 1:00 |     BRONX |   10454 | 40.80355 | -73.91184 |  (40.803555, -73.91184) | EAST 137 STREET                  |             WILLOW AVENUE |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |              Pavement Slippery |                    Unspecified |              |           |           |  4021878  |                   Garbage or Refuse  | Station Wagon/Sport Utility Vehicle  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  5. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 1:00 |  BROOKLYN |   11221 | 40.69492 | -73.91557 | (40.694923, -73.915565) | WILSON AVENUE                    |           PALMETTO STREET |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |              Pavement Slippery |                    Unspecified |              |           |           |  4021848  | Station Wagon/Sport Utility Vehicle  | Station Wagon/Sport Utility Vehicle  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  6. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 1:20 |           |         |  40.8047 | -73.91243 |    (40.8047, -73.91243) | EAST 138 STREET                  |        BRUCKNER BOULEVARD |          |        1 |        0 |        1 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |                                |                                |              |           |           |  4021877  |                                      |                                      |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  7. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 1:41 |           |         | 40.73768 | -73.85206 |  (40.737682, -73.85206) | 108 STREET                       | HORACE HARDING EXPRESSWAY |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |          Following Too Closely |                    Unspecified |              |           |           |  4021798  |                               Sedan  |                               Sedan  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  8. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 2:50 |     BRONX |   10451 | 40.81906 | -73.92923 |  (40.819057, -73.92923) | EAST 149 STREET                  |             GERARD AVENUE |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 | Driver Inattention/Distraction |                    Unspecified |              |           |           |  4021864  |                                Taxi  |                                Taxi  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "  9. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 4:22 |           |         | 40.81175 | -73.93144 |   (40.81175, -73.93144) | MAJOR DEEGAN EXPRESSWAY          |                           |          |        0 |        0 |        0 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 |                   Unsafe Speed |                    Unspecified | Unspecified  |           |           |  4021857  | Station Wagon/Sport Utility Vehicle  | Station Wagon/Sport Utility Vehicle  |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       " 10. |       date | time |   borough | zipcode | latitude | longitude |                location |                     onstreetname |           crossstreetname | offstr~e | number.. | number.. | number.. | number.. | number.. | number.. | number.. |\n",
       "     | 11/16/2018 | 5:30 |    QUEENS |   11417 | 40.67887 | -73.83419 |   (40.67887, -73.83419) | ROCKAWAY BOULEVARD               |        CENTREVILLE AVENUE |          |        1 |        0 |        1 |        0 |        0 |        0 |        0 |\n",
       "     |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n",
       "     | number.. |     contributingfactorvehicle1 |     contributingfactorvehicle2 | contribut~3  | contri~4  | contri~5  | unique~y  |                    vehicletypecode1  |                    vehicletypecode2  | vehicl~3  | vehicl~4  | vehicl~5  |\n",
       "     |        0 | Driver Inattention/Distraction |                                |              |           |           |  4021833  |                                      |                                      |           |           |           |\n",
       "     +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n",
       "\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "%head"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Re-order variables\n",
    "Personally, I prefer ID type variables to be in the first few columns of the dataset. We will use Stata's `order` command to move the variable uniquekey to the first column."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "order(uniquekey), before(date)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Create date time variables\n",
    "1. Preview the date variable (through `list`, `codebook`, `browse`(Data Editor))\n",
    "2. Determine the format of the date variable\n",
    "    - Is it a string, int, float, etc\n",
    "3. Determine if it is in other types of date format (e.g. Excel's date format)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Using %head %tail %browse is a function of stata kernel. Please visit https://kylebarron.dev/stata_kernel/using_stata_kernel/magics/ for more information."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>11/16/2018</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "\n",
       "     +------------+\n",
       "     |       date |\n",
       "     |------------|\n",
       "  1. | 11/16/2018 |\n",
       "  2. | 11/16/2018 |\n",
       "  3. | 11/16/2018 |\n",
       "  4. | 11/16/2018 |\n",
       "  5. | 11/16/2018 |\n",
       "     |------------|\n",
       "  6. | 11/16/2018 |\n",
       "  7. | 11/16/2018 |\n",
       "  8. | 11/16/2018 |\n",
       "  9. | 11/16/2018 |\n",
       " 10. | 11/16/2018 |\n",
       "     +------------+\n",
       "\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "%head date"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "     +------------+\n",
      "     |       date |\n",
      "     |------------|\n",
      "  1. | 11/16/2018 |\n",
      "  2. | 11/16/2018 |\n",
      "  3. | 11/16/2018 |\n",
      "  4. | 11/16/2018 |\n",
      "     +------------+\n"
     ]
    }
   ],
   "source": [
    "list date in 1/4"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
      "date                                                                                                                                                                                                                                                       DATE\n",
      "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n",
      "\n",
      "                  type:  string (str105)\n",
      "\n",
      "         unique values:  2,331                    missing \"\":  0/1,386,003\n",
      "\n",
      "              examples:  \"03/24/2015\"\n",
      "                         \"06/08/2017\"\n",
      "                         \"08/15/2015\"\n",
      "                         \"10/20/2013\"\n",
      "\n",
      "               warning:  variable has leading and embedded blanks\n"
     ]
    }
   ],
   "source": [
    "codebook date"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now, we determine that the date variable is in a string format. We will use Stata's HRF-to-SIF conversion functions in the `datetime` command."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(1 missing value generated)\n"
     ]
    }
   ],
   "source": [
    "gen date_SIF = date(date, \"MDY\"),after(date)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We know that the date is a string variable, and it is in HRF( Human readable form) in the form of Month/Day/Year. We tell Stata's `date()` function that through the mask `\"MDY\"`. Then, I tell Stata to put date_SIF in the column after date."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "     +----------+\n",
      "     | date_SIF |\n",
      "     |----------|\n",
      "  1. |    21504 |\n",
      "  2. |    21504 |\n",
      "  3. |    21504 |\n",
      "  4. |    21504 |\n",
      "     +----------+\n"
     ]
    }
   ],
   "source": [
    "list date_SIF in 1/4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The variable is in SIF(Stata internal form) now. So Stata understands it is a date. But in order for us to understand, we tell Stata to display this number in HRF through the `format` command. The date format is `%td` and the time format is `%tc`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "format date_SIF %td"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We repeat this for time variable."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "(1 missing value generated)\n",
      "\n"
     ]
    }
   ],
   "source": [
    "gen time_SIF = clock(time, \"hm\"),after(time)\n",
    "format time_SIF %tc"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Why do we want Stata to understand dates and times? \n",
    "Because it allows us to do so much more!\n",
    "- view summary statistics of the date (e.g. first date, last date)\n",
    "- create year and month variables\n",
    "- create dummies based on durations\n",
    "- create dummies based on boolean logic"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "    Variable |        Obs        Mean    Std. Dev.       Min        Max\n",
      "-------------+---------------------------------------------------------\n",
      "    date_SIF |  1,386,002   14oct2015    669.6435  01jul2012  16nov2018\n"
     ]
    }
   ],
   "source": [
    "sum date_SIF, format"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(1 missing value generated)\n"
     ]
    }
   ],
   "source": [
    "gen year_SIF = year(date_SIF) // Extract year from the date"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(1 missing value generated)\n"
     ]
    }
   ],
   "source": [
    "gen month_SIF = month(date_SIF) // Extract month from the date"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "\n",
      "\n",
      "special_per |\n",
      "        iod |      Freq.     Percent        Cum.\n",
      "------------+-----------------------------------\n",
      "          0 |  1,370,768       98.90       98.90\n",
      "          1 |     15,235        1.10      100.00\n",
      "------------+-----------------------------------\n",
      "      Total |  1,386,003      100.00\n"
     ]
    }
   ],
   "source": [
    "gen special_period = (date_SIF >= td(14feb2014) & date_SIF <= td(14march2014))\n",
    "tab special_period"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Renaming long variable names\n",
    "This is entirely up to you. I prefer a shorter variable name, and use labels to store the longer and more descriptive name. Labeling is the more important thing to do when you begin this process of building an analytical dataset."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "rename numberofcyclistinjured cyclistinjured\n",
    "rename numberofcyclistkilled cyclistkilled"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "label variable cyclistinjured \"Number of cyclists injured\"\n",
    "label variable cyclistkilled \"Number of cyclists killed\""
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Creating dummies from long strings\n",
    "I will show you several methods to finding keywords from string variables. For example, we want to create a variable to indicate if a collision occurred with a bicycle.\n",
    "- `strpos`\n",
    "- contains exact \"string\""
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "1. Explore the string variable that we want to extract information from."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "                VEHICLE TYPE CODE 1 |      Freq.     Percent        Cum.\n",
      "------------------------------------+-----------------------------------\n",
      "                              (ceme |          1        0.00        0.00\n",
      "                              15 Pa |          1        0.00        0.00\n",
      "                              2 TON |          1        0.00        0.00\n",
      "                         2 dr sedan |          6        0.00        0.00\n",
      "                             3-Door |         30        0.00        0.00\n",
      "                              315 e |          1        0.00        0.00\n",
      "                                 3D |         32        0.00        0.01\n",
      "                         4 dr sedan |        202        0.01        0.02\n",
      "                               4DSD |          3        0.00        0.02\n",
      "                              4whee |          1        0.00        0.02\n",
      "                              99999 |          1        0.00        0.02\n",
      "                              ABULA |          1        0.00        0.02\n",
      "                              ACCES |          2        0.00        0.02\n",
      "                                 AM |        292        0.02        0.04\n",
      "                              AMABU |          1        0.00        0.04\n",
      "                                AMB |          7        0.00        0.04\n",
      "                               AMBU |          5        0.00        0.04\n",
      "                              AMBUL |        111        0.01        0.05\n",
      "                          AMBULANCE |      2,406        0.17        0.23\n",
      "                              AMbul |          1        0.00        0.23\n",
      "                              APORT |          1        0.00        0.23\n",
      "                              APPOR |          1        0.00        0.23\n",
      "                                 AR |         41        0.00        0.23\n",
      "                              ARMOR |          1        0.00        0.23\n",
      "                               ARMY |          1        0.00        0.23\n",
      "                              Ambul |         20        0.00        0.23\n",
      "                          Ambulance |        265        0.02        0.25\n",
      "                      Armored Truck |         42        0.00        0.25\n",
      "                                 BA |          6        0.00        0.25\n",
      "                               BACK |          2        0.00        0.25\n",
      "                              BACKH |          4        0.00        0.25\n",
      "                              BED T |          1        0.00        0.25\n",
      "                              BICYC |          1        0.00        0.25\n",
      "                            BICYCLE |      5,567        0.40        0.66\n",
      "                               BOAT |          1        0.00        0.66\n",
      "                              BOBCA |          3        0.00        0.66\n",
      "                                BOX |          1        0.00        0.66\n",
      "                              BOX T |          5        0.00        0.66\n",
      "                                 BR |         42        0.00        0.66\n",
      "                                 BS |          2        0.00        0.66\n",
      "                                 BU |      2,229        0.16        0.82\n",
      "                              BULLD |          2        0.00        0.82\n",
      "                                BUS |     14,057        1.02        1.85\n",
      "                                BUs |          1        0.00        1.85\n",
      "                              Backh |          1        0.00        1.85\n",
      "                     Beverage Truck |         31        0.00        1.85\n",
      "                               Bike |      1,912        0.14        1.99\n",
      "                               Boom |          1        0.00        1.99\n",
      "                                Box |          1        0.00        1.99\n",
      "                          Box Truck |      2,676        0.19        2.18\n",
      "                              Box t |          1        0.00        2.18\n",
      "                              Bucke |          1        0.00        2.18\n",
      "                   Bulk Agriculture |          4        0.00        2.18\n",
      "                                Bus |      1,992        0.14        2.33\n",
      "                              CABIN |          1        0.00        2.33\n",
      "                               CAMP |          1        0.00        2.33\n",
      "                              CARGO |          2        0.00        2.33\n",
      "                               CART |          1        0.00        2.33\n",
      "                                 CB |         89        0.01        2.34\n",
      "                              CHERR |          1        0.00        2.34\n",
      "                              CHEVY |          1        0.00        2.34\n",
      "                                 CM |         41        0.00        2.34\n",
      "                               CMIX |          1        0.00        2.34\n",
      "                                 CO |          2        0.00        2.34\n",
      "                                COM |          8        0.00        2.34\n",
      "                              COM T |          1        0.00        2.34\n",
      "                               COM. |          1        0.00        2.34\n",
      "                               COMB |          1        0.00        2.34\n",
      "                              COMME |         11        0.00        2.34\n",
      "                              COMMM |          1        0.00        2.34\n",
      "                              CONCR |          1        0.00        2.34\n",
      "                              CONST |          1        0.00        2.34\n",
      "                               CONV |        398        0.03        2.37\n",
      "                              COUPE |          1        0.00        2.37\n",
      "                              CRANE |          1        0.00        2.37\n",
      "                              CUSHM |          1        0.00        2.37\n",
      "                              Cargo |          1        0.00        2.37\n",
      "                          Carry All |        178        0.01        2.38\n",
      "                              Cat 9 |          1        0.00        2.38\n",
      "                        Chassis Cab |         83        0.01        2.39\n",
      "                               Cmix |          1        0.00        2.39\n",
      "                              Comix |          1        0.00        2.39\n",
      "                               Comm |          1        0.00        2.39\n",
      "                              Comme |          1        0.00        2.39\n",
      "                     Concrete Mixer |         67        0.00        2.39\n",
      "                        Convertible |        428        0.03        2.42\n",
      "                              DELIV |         14        0.00        2.43\n",
      "                               DELV |          2        0.00        2.43\n",
      "                              DEMA- |          1        0.00        2.43\n",
      "                               DIRT |          1        0.00        2.43\n",
      "                              DOT R |          1        0.00        2.43\n",
      "                                 DP |        367        0.03        2.45\n",
      "                                 DS |      1,006        0.07        2.53\n",
      "                               DUMP |         17        0.00        2.53\n",
      "                              DUMPT |          1        0.00        2.53\n",
      "                              DUNBA |          1        0.00        2.53\n",
      "                              Deliv |          1        0.00        2.53\n",
      "                               Dump |        414        0.03        2.56\n",
      "                              Dumps |          1        0.00        2.56\n",
      "                              E BIK |          1        0.00        2.56\n",
      "                              E ONE |          1        0.00        2.56\n",
      "                              E SCO |          1        0.00        2.56\n",
      "                              E-BIK |          4        0.00        2.56\n",
      "                              E-Bik |          2        0.00        2.56\n",
      "                              E-MOT |          1        0.00        2.56\n",
      "                              E/BIK |          1        0.00        2.56\n",
      "                              EBIKE |          2        0.00        2.56\n",
      "                              ELECT |         15        0.00        2.56\n",
      "                              EMRGN |          1        0.00        2.56\n",
      "                              EMS A |          1        0.00        2.56\n",
      "                              EMS H |          1        0.00        2.56\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "                                 EN |          2        0.00        2.56\n",
      "                                EPO |          1        0.00        2.56\n",
      "                              Elect |          3        0.00        2.56\n",
      "Enclosed Body - Removable Enclosure |          2        0.00        2.56\n",
      "                                 FB |        238        0.02        2.58\n",
      "                              FD NY |          1        0.00        2.58\n",
      "                              FD tr |          1        0.00        2.58\n",
      "                               FDNY |         34        0.00        2.58\n",
      "                              FED E |          2        0.00        2.58\n",
      "                               FIRE |         25        0.00        2.58\n",
      "                         FIRE TRUCK |        850        0.06        2.64\n",
      "                              FIRET |         10        0.00        2.64\n",
      "                               FLAT |          9        0.00        2.65\n",
      "                              FLATB |          1        0.00        2.65\n",
      "                               FORD |          4        0.00        2.65\n",
      "                               FORK |          2        0.00        2.65\n",
      "                              FORK- |          1        0.00        2.65\n",
      "                              FORKL |         11        0.00        2.65\n",
      "                                 FR |         34        0.00        2.65\n",
      "                               FREE |          1        0.00        2.65\n",
      "                              FREIG |          6        0.00        2.65\n",
      "                              FRONT |          1        0.00        2.65\n",
      "                              Fd fi |          1        0.00        2.65\n",
      "                               Fdny |          2        0.00        2.65\n",
      "                               Fire |         15        0.00        2.65\n",
      "                              Firet |          1        0.00        2.65\n",
      "                           Flat Bed |        226        0.02        2.67\n",
      "                          Flat Rack |         51        0.00        2.67\n",
      "                               Ford |          1        0.00        2.67\n",
      "                              Forkl |          2        0.00        2.67\n",
      "                              Freig |          1        0.00        2.67\n",
      "                              GARBA |          4        0.00        2.67\n",
      "                              GE/SC |          1        0.00        2.67\n",
      "                                 GG |        205        0.01        2.69\n",
      "                               GOLF |          1        0.00        2.69\n",
      "                              GOVER |          1        0.00        2.69\n",
      "                                 GR |          2        0.00        2.69\n",
      "                               GRAY |          1        0.00        2.69\n",
      "                              Garba |          2        0.00        2.69\n",
      "                  Garbage or Refuse |        223        0.02        2.70\n",
      "                         Glass Rack |          1        0.00        2.70\n",
      "                               Golf |          2        0.00        2.70\n",
      "                               H/WH |          1        0.00        2.70\n",
      "                              HEAVY |          1        0.00        2.70\n",
      "                               HELP |          1        0.00        2.70\n",
      "                                 HO |          1        0.00        2.70\n",
      "                              HORSE |          2        0.00        2.70\n",
      "                              HWY C |          1        0.00        2.70\n",
      "                               Hand |          1        0.00        2.70\n",
      "                             Hopper |          3        0.00        2.70\n",
      "                              Humme |          1        0.00        2.70\n",
      "                                 IP |          1        0.00        2.70\n",
      "                              Ice C |          1        0.00        2.71\n",
      "                              Inter |          1        0.00        2.71\n",
      "                               John |          1        0.00        2.71\n",
      "     LARGE COM VEH(6 OR MORE TIRES) |     14,527        1.06        3.76\n",
      "                                 LF |         16        0.00        3.76\n",
      "                              LIBER |          1        0.00        3.76\n",
      "                               LIMO |          3        0.00        3.76\n",
      "                              LIVER |          2        0.00        3.76\n",
      "                     LIVERY VEHICLE |     10,481        0.76        4.53\n",
      "                                 LL |        169        0.01        4.54\n",
      "                              LOADE |          1        0.00        4.54\n",
      "                                 LP |          1        0.00        4.54\n",
      "                                 LW |          2        0.00        4.54\n",
      "                               Lift |          1        0.00        4.54\n",
      "                          Lift Boom |         19        0.00        4.54\n",
      "                              Light |          1        0.00        4.54\n",
      "                              Limou |          1        0.00        4.54\n",
      "                     Livestock Rack |          2        0.00        4.54\n",
      "                                Log |          1        0.00        4.54\n",
      "                        Lunch Wagon |          4        0.00        4.54\n",
      "                               MACK |          2        0.00        4.54\n",
      "                               MAIL |          4        0.00        4.54\n",
      "                               MARK |          1        0.00        4.54\n",
      "                                 MB |         20        0.00        4.54\n",
      "                                 MD |         32        0.00        4.54\n",
      "                                 MH |          3        0.00        4.54\n",
      "                              MILLI |          1        0.00        4.54\n",
      "                               MINI |          3        0.00        4.54\n",
      "                                 MK |          1        0.00        4.54\n",
      "                              MOPED |         10        0.00        4.55\n",
      "                              MOTOR |          6        0.00        4.55\n",
      "                         MOTORCYCLE |      6,536        0.48        5.02\n",
      "                                 MS |         42        0.00        5.02\n",
      "                              MTA B |          4        0.00        5.02\n",
      "                              Marke |          1        0.00        5.02\n",
      "                               Mini |          1        0.00        5.02\n",
      "                           Minibike |          7        0.00        5.03\n",
      "                          Minicycle |          4        0.00        5.03\n",
      "                              Mo pa |          1        0.00        5.03\n",
      "                              Moped |         56        0.00        5.03\n",
      "                              Motor |          2        0.00        5.03\n",
      "                          Motorbike |         41        0.00        5.03\n",
      "                         Motorcycle |        877        0.06        5.10\n",
      "                     Motorized Home |          4        0.00        5.10\n",
      "                       Motorscooter |         62        0.00        5.10\n",
      "              Multi-Wheeled Vehicle |         15        0.00        5.10\n",
      "                                N/A |          1        0.00        5.10\n",
      "                              NEW Y |          2        0.00        5.10\n",
      "                              NS AM |          1        0.00        5.10\n",
      "                              NYC B |          1        0.00        5.10\n",
      "                              NYC M |          1        0.00        5.10\n",
      "                              NYC a |          1        0.00        5.10\n",
      "                               NYPD |          2        0.00        5.10\n",
      "                              OIL T |          2        0.00        5.10\n",
      "                                OML |          1        0.00        5.10\n",
      "                              OMNIB |          1        0.00        5.10\n",
      "                                OMR |          5        0.00        5.10\n",
      "                                OMT |          2        0.00        5.10\n",
      "                              OTHER |     23,972        1.74        6.85\n",
      "                          Open Body |          5        0.00        6.85\n",
      "                               P/SE |          1        0.00        6.85\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "                               P/SH |          2        0.00        6.85\n",
      "                                PAS |          2        0.00        6.85\n",
      "                  PASSENGER VEHICLE |    715,227       52.00       58.85\n",
      "                              PEDIC |          1        0.00       58.85\n",
      "                            PEDICAB |         35        0.00       58.85\n",
      "                              PICK- |          1        0.00       58.85\n",
      "                      PICK-UP TRUCK |     23,069        1.68       60.53\n",
      "                              PICKU |          4        0.00       60.53\n",
      "                                 PK |        405        0.03       60.56\n",
      "                                 PL |          6        0.00       60.56\n",
      "                                 PM |          7        0.00       60.56\n",
      "                              POSTA |          4        0.00       60.56\n",
      "                              POSTO |          1        0.00       60.56\n",
      "                              POWER |          7        0.00       60.56\n",
      "                                PSD |          4        0.00       60.56\n",
      "                                PSR |          1        0.00       60.56\n",
      "                               PUMP |          1        0.00       60.56\n",
      "                             Pallet |          7        0.00       60.56\n",
      "                            Pedicab |         11        0.00       60.56\n",
      "                               Pick |          1        0.00       60.56\n",
      "                              Pick- |          1        0.00       60.56\n",
      "                      Pick-up Truck |      3,883        0.28       60.85\n",
      "                              Picku |          1        0.00       60.85\n",
      "         Pickup with mounted Camper |          5        0.00       60.85\n",
      "                              Porta |          1        0.00       60.85\n",
      "                                R/V |          1        0.00       60.85\n",
      "                              R/V C |          1        0.00       60.85\n",
      "                              REFRI |          3        0.00       60.85\n",
      "                              RENTA |          1        0.00       60.85\n",
      "                                REP |          2        0.00       60.85\n",
      "                              RESCU |          1        0.00       60.85\n",
      "                                 RF |         56        0.00       60.85\n",
      "                                 RV |         11        0.00       60.85\n",
      "                              RYDER |          1        0.00       60.85\n",
      "                   Refrigerated Van |         58        0.00       60.86\n",
      "                              SANIT |          6        0.00       60.86\n",
      "                              SCHOO |         16        0.00       60.86\n",
      "                              SCOOT |         10        0.00       60.86\n",
      "                            SCOOTER |        256        0.02       60.88\n",
      "                                 SE |          1        0.00       60.88\n",
      "                               SELF |          4        0.00       60.88\n",
      "                               SEMI |          2        0.00       60.88\n",
      "                              SEMI- |          1        0.00       60.88\n",
      "                              SKATE |          3        0.00       60.88\n",
      "            SMALL COM VEH(4 TIRES)  |     14,559        1.06       61.94\n",
      "                              SMART |          1        0.00       61.94\n",
      "                               SNOW |          1        0.00       61.94\n",
      "                                 SP |         20        0.00       61.94\n",
      "                                SPC |          2        0.00       61.94\n",
      "      SPORT UTILITY / STATION WAGON |    313,498       22.79       84.73\n",
      "                              SPRIN |          1        0.00       84.73\n",
      "                                 ST |         15        0.00       84.74\n",
      "                              ST150 |          1        0.00       84.74\n",
      "                               STAK |          5        0.00       84.74\n",
      "                              STREE |          6        0.00       84.74\n",
      "                              SUBN/ |          1        0.00       84.74\n",
      "                              SUBUR |          1        0.00       84.74\n",
      "                                SUV |          3        0.00       84.74\n",
      "                              SWEEP |          1        0.00       84.74\n",
      "                              Sanit |          1        0.00       84.74\n",
      "                              Schoo |          1        0.00       84.74\n",
      "                         School Bus |          9        0.00       84.74\n",
      "                              Scoot |          1        0.00       84.74\n",
      "                              Sedan |     56,607        4.12       88.85\n",
      "                               Semi |          1        0.00       88.85\n",
      "                              Semi- |          1        0.00       88.85\n",
      "                              Skate |          1        0.00       88.85\n",
      "                              Smart |          1        0.00       88.85\n",
      "                          Snow Plow |          1        0.00       88.85\n",
      "                                Spc |          1        0.00       88.85\n",
      "                              Sprin |          2        0.00       88.85\n",
      "                      Stake or Rack |         11        0.00       88.85\n",
      "Station Wagon/Sport Utility Vehicle |     43,706        3.18       92.03\n",
      "                               Subn |          1        0.00       92.03\n",
      "                              Sweep |          1        0.00       92.03\n",
      "                               TANK |          2        0.00       92.03\n",
      "                              TANKE |          2        0.00       92.03\n",
      "                               TAXI |     50,669        3.68       95.72\n",
      "                                 TK |      2,485        0.18       95.90\n",
      "                                 TN |         77        0.01       95.90\n",
      "                                TOW |          3        0.00       95.90\n",
      "                              TOW T |         13        0.00       95.90\n",
      "                              TOWTR |          2        0.00       95.90\n",
      "                                 TR |        160        0.01       95.92\n",
      "                               TRAC |          3        0.00       95.92\n",
      "                              TRACK |          1        0.00       95.92\n",
      "                              TRACT |         21        0.00       95.92\n",
      "                              TRAFF |          1        0.00       95.92\n",
      "                              TRAIL |         52        0.00       95.92\n",
      "                              TRANS |          3        0.00       95.92\n",
      "                                TRK |          2        0.00       95.92\n",
      "                                TRL |          3        0.00       95.92\n",
      "                              TRLPM |          1        0.00       95.92\n",
      "                               TRLR |          2        0.00       95.92\n",
      "                              TRUCK |         45        0.00       95.93\n",
      "                                 TT |        130        0.01       95.94\n",
      "                             Tanker |         76        0.01       95.94\n",
      "                               Taxi |      5,894        0.43       96.37\n",
      "                                Tow |          1        0.00       96.37\n",
      "                              Tow T |          1        0.00       96.37\n",
      "                          Tow Truck |          4        0.00       96.37\n",
      "                Tow Truck / Wrecker |        125        0.01       96.38\n",
      "                              Tow t |          1        0.00       96.38\n",
      "                              Tow-t |          1        0.00       96.38\n",
      "                              Tract |          3        0.00       96.38\n",
      "               Tractor Truck Diesel |      1,175        0.09       96.46\n",
      "             Tractor Truck Gasoline |        159        0.01       96.48\n",
      "                              Trail |          5        0.00       96.48\n",
      "                              Truck |          2        0.00       96.48\n",
      "                               U.S. |          1        0.00       96.48\n",
      "                              UHAUL |          4        0.00       96.48\n",
      "                              UHUAL |          1        0.00       96.48\n",
      "                                UKN |          1        0.00       96.48\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "                              UNKNO |          1        0.00       96.48\n",
      "                            UNKNOWN |     19,929        1.45       97.93\n",
      "                              UPS T |          1        0.00       97.93\n",
      "                              UPS t |          1        0.00       97.93\n",
      "                              US PO |          1        0.00       97.93\n",
      "                               USPS |         16        0.00       97.93\n",
      "                                 UT |          1        0.00       97.93\n",
      "                               UTIL |          4        0.00       97.93\n",
      "                              UTILI |          6        0.00       97.93\n",
      "                                UTV |          1        0.00       97.93\n",
      "                              Unkno |          1        0.00       97.93\n",
      "                               Util |          1        0.00       97.93\n",
      "                              Utili |          2        0.00       97.93\n",
      "                                VAN |     26,540        1.93       99.86\n",
      "                              VAN T |          1        0.00       99.86\n",
      "                              VAN/T |          2        0.00       99.86\n",
      "                               VANG |          1        0.00       99.86\n",
      "                                 VC |          2        0.00       99.86\n",
      "                                 VN |        712        0.05       99.91\n",
      "                                 VT |          2        0.00       99.91\n",
      "                                Van |        906        0.07       99.98\n",
      "                         Van Camper |          4        0.00       99.98\n",
      "                            Vanette |          1        0.00       99.98\n",
      "                              Veriz |          1        0.00       99.98\n",
      "                              WAGON |          1        0.00       99.98\n",
      "                                 WD |          1        0.00       99.98\n",
      "                               WHBL |          1        0.00       99.98\n",
      "                              WHEEL |          1        0.00       99.98\n",
      "                              WHITE |          1        0.00       99.98\n",
      "                               WORK |          2        0.00       99.98\n",
      "                              Wagon |          1        0.00       99.98\n",
      "                       Well Driller |          1        0.00       99.98\n",
      "                              Wheel |          1        0.00       99.98\n",
      "                               Work |          1        0.00       99.98\n",
      "                              YELLO |          2        0.00       99.98\n",
      "                               ambu |          5        0.00       99.98\n",
      "                              ambul |         21        0.00       99.98\n",
      "                              armor |          1        0.00       99.98\n",
      "                              box t |          7        0.00       99.98\n",
      "                              bulld |          1        0.00       99.98\n",
      "                                bus |          7        0.00       99.98\n",
      "                              cargo |          1        0.00       99.98\n",
      "                               cate |          1        0.00       99.98\n",
      "                              cemen |          1        0.00       99.98\n",
      "                              chevo |          1        0.00       99.98\n",
      "                                com |          2        0.00       99.98\n",
      "                              comme |          3        0.00       99.98\n",
      "                              deliv |          3        0.00       99.98\n",
      "                               delv |          3        0.00       99.98\n",
      "                                 dp |          1        0.00       99.98\n",
      "                               dsny |          1        0.00       99.98\n",
      "                               dump |          5        0.00       99.98\n",
      "                              e BIK |          1        0.00       99.98\n",
      "                              e amb |          1        0.00       99.98\n",
      "                              e com |          1        0.00       99.98\n",
      "                              e sco |          1        0.00       99.98\n",
      "                              e-bik |          2        0.00       99.98\n",
      "                               east |          1        0.00       99.98\n",
      "                              elect |          3        0.00       99.98\n",
      "                               f550 |          1        0.00       99.98\n",
      "                              fd tr |          1        0.00       99.98\n",
      "                               fdny |          8        0.00       99.98\n",
      "                               fire |         13        0.00       99.99\n",
      "                              firet |          1        0.00       99.99\n",
      "                               flat |          1        0.00       99.99\n",
      "                              flatb |          1        0.00       99.99\n",
      "                               ford |          2        0.00       99.99\n",
      "                               fork |          1        0.00       99.99\n",
      "                              forkl |          4        0.00       99.99\n",
      "                              garba |          3        0.00       99.99\n",
      "                              gator |          1        0.00       99.99\n",
      "                              ice c |          1        0.00       99.99\n",
      "                              icecr |          1        0.00       99.99\n",
      "                              ladde |          1        0.00       99.99\n",
      "                              light |          1        0.00       99.99\n",
      "                               mail |          1        0.00       99.99\n",
      "                                mcy |          1        0.00       99.99\n",
      "                              mopad |          1        0.00       99.99\n",
      "                              motor |          3        0.00       99.99\n",
      "                                mta |          1        0.00       99.99\n",
      "                              mta b |          2        0.00       99.99\n",
      "                              nyc a |          1        0.00       99.99\n",
      "                               omni |          1        0.00       99.99\n",
      "                               p/sh |          1        0.00       99.99\n",
      "                                pas |          1        0.00       99.99\n",
      "                              passa |          1        0.00       99.99\n",
      "                               pick |          4        0.00       99.99\n",
      "                              posta |          2        0.00       99.99\n",
      "                              power |          1        0.00       99.99\n",
      "                               rd/s |          1        0.00       99.99\n",
      "                               refg |          1        0.00       99.99\n",
      "                                 rv |          2        0.00       99.99\n",
      "                              sanit |          2        0.00       99.99\n",
      "                              schoo |          7        0.00       99.99\n",
      "                              sciss |          1        0.00       99.99\n",
      "                              scoot |          2        0.00       99.99\n",
      "                              seagr |          1        0.00       99.99\n",
      "                               self |          1        0.00       99.99\n",
      "                               semi |          2        0.00       99.99\n",
      "                               sgws |          1        0.00       99.99\n",
      "                              spc p |          1        0.00       99.99\n",
      "                               spec |          1        0.00       99.99\n",
      "                              stree |          1        0.00       99.99\n",
      "                               subn |          3        0.00       99.99\n",
      "                                 tk |          1        0.00       99.99\n",
      "                                tow |          2        0.00       99.99\n",
      "                              tow t |          3        0.00       99.99\n",
      "                               trac |          1        0.00       99.99\n",
      "                              tract |          6        0.00       99.99\n",
      "                              trail |         17        0.00       99.99\n",
      "                                trk |          1        0.00       99.99\n",
      "                               trlr |          1        0.00       99.99\n",
      "                              truck |          9        0.00       99.99\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "                              uhaul |          1        0.00       99.99\n",
      "                              ulili |          1        0.00       99.99\n",
      "                                unk |          3        0.00       99.99\n",
      "                              unkno |          4        0.00       99.99\n",
      "                              ups t |          1        0.00       99.99\n",
      "                               usps |          2        0.00       99.99\n",
      "                              utili |          6        0.00       99.99\n",
      "                                van |         75        0.01      100.00\n",
      "                              van t |          1        0.00      100.00\n",
      "                                vol |          1        0.00      100.00\n",
      "------------------------------------+-----------------------------------\n",
      "                              Total |  1,375,333      100.00\n"
     ]
    }
   ],
   "source": [
    "tab vehicletypecode1"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "2. Find some key words. E.g. BICYCLE, Bike"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "gen bicyclerelated = vehicletypecode1 == \"BICYCLE\" | vehicletypecode1 == \"Bike\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "bicyclerela |\n",
      "        ted |      Freq.     Percent        Cum.\n",
      "------------+-----------------------------------\n",
      "          0 |  1,378,524       99.46       99.46\n",
      "          1 |      7,479        0.54      100.00\n",
      "------------+-----------------------------------\n",
      "      Total |  1,386,003      100.00\n"
     ]
    }
   ],
   "source": [
    "tab bicyclerelated"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The above method requires that vehicletypecode1 have exactly those characters within the double quotation marks. If \"BICYCLE\" were spelt in lower capitals, the command above will not capture it. Hence, we can \"improve\" upon the code by using `lower()` or `upper()` functions to ensure that the strings are in the right form."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "gen bicyclerelated_2 = upper(vehicletypecode1) == \"BICYCLE\" | upper(vehicletypecode1) == \"BIKE\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "bicyclerela |\n",
      "      ted_2 |      Freq.     Percent        Cum.\n",
      "------------+-----------------------------------\n",
      "          0 |  1,378,524       99.46       99.46\n",
      "          1 |      7,479        0.54      100.00\n",
      "------------+-----------------------------------\n",
      "      Total |  1,386,003      100.00\n"
     ]
    }
   ],
   "source": [
    "tab bicyclerelated_2"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The method above is tedious because it requires that you look for every single keyword that is related to a bicycle. For example, in order to identify Minibike, you need to know that it exists in vehicletypecode1. We can use Stata's `strpos` function to look within a string for a keyword. If the keyword exists in a string, `strpos` will return the position number. Hence, it enables us to detect "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [],
   "source": [
    "gen bicyclerelated_3 = strpos(upper(vehicletypecode1), \"BICYCLE\") >0 | strpos(upper(vehicletypecode1), \"BIKE\") >0"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "bicyclerela |\n",
      "      ted_3 |      Freq.     Percent        Cum.\n",
      "------------+-----------------------------------\n",
      "          0 |  1,378,474       99.46       99.46\n",
      "          1 |      7,529        0.54      100.00\n",
      "------------+-----------------------------------\n",
      "      Total |  1,386,003      100.00\n"
     ]
    }
   ],
   "source": [
    "tab bicyclerelated_3"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Cases of BICYC found in vehicletypecode1\n",
      "\n",
      "                              BICYC |      Freq.     Percent        Cum.\n",
      "------------------------------------+-----------------------------------\n",
      "                            BICYCLE |      5,567       99.98       99.98\n",
      "                              BICYC |          1        0.02      100.00\n",
      "------------------------------------+-----------------------------------\n",
      "                              Total |      5,568      100.00\n",
      "\n"
     ]
    }
   ],
   "source": [
    "screening, sources(vehicletypecode1, upper) explore(tab) keys(BICYCLE) letters(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Cases of BIK found in vehicletypecode1\n",
      "\n",
      "                                BIK |      Freq.     Percent        Cum.\n",
      "------------------------------------+-----------------------------------\n",
      "                               BIKE |      1,912       96.91       96.91\n",
      "                          MOTORBIKE |         41        2.08       98.99\n",
      "                              E-BIK |          8        0.41       99.39\n",
      "                           MINIBIKE |          7        0.35       99.75\n",
      "                              E BIK |          2        0.10       99.85\n",
      "                              EBIKE |          2        0.10       99.95\n",
      "                              E/BIK |          1        0.05      100.00\n",
      "------------------------------------+-----------------------------------\n",
      "                              Total |      1,973      100.00\n",
      "\n"
     ]
    }
   ],
   "source": [
    "screening, sources(vehicletypecode1, upper) explore(tab) keys(BIKE) letters(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "                VEHICLE TYPE CODE 1 |      Freq.     Percent        Cum.\n",
      "------------------------------------+-----------------------------------\n",
      "                               Bike |      1,912       97.45       97.45\n",
      "                              EBIKE |          2        0.10       97.55\n",
      "                           Minibike |          7        0.36       97.91\n",
      "                          Motorbike |         41        2.09      100.00\n",
      "------------------------------------+-----------------------------------\n",
      "                              Total |      1,962      100.00\n"
     ]
    }
   ],
   "source": [
    "tab vehicletypecode1 if strpos(upper(vehicletypecode1), \"BIKE\")> 0"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "You will notice that \"Motorbike\" is included in the list. This erroneously added 41 observations to bicyclerelated_3."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\n",
    "\n",
    "\n",
    "// Identify Bicycle related collisions\n",
    "gen bicyclerelated = ///\n",
    "vehicletypecode1 == \"BICYCLE\" | ///\n",
    "vehicletypecode2 == \"BICYCLE\" | ///\n",
    "vehicletypecode3 == \"BICYCLE\" | ///\n",
    "vehicletypecode4 == \"BICYCLE\" | ///\n",
    "vehicletypecode5 == \"BICYCLE\" | ///\n",
    "vehicletypecode1 == \"PEDICAB\" | ///\n",
    "vehicletypecode2 == \"PEDICAB\" | ///\n",
    "vehicletypecode3 == \"PEDICAB\" | ///\n",
    "vehicletypecode4 == \"PEDICAB\" | ///\n",
    "vehicletypecode5 == \"PEDICAB\"\n",
    "\n",
    "// Explore the coodinates\n",
    "codebook latitude\n",
    "codebook longitude\n",
    "\n",
    "// There are missing data in the latitude and longitude\n",
    "gen mi_latlong = mi(latitude) & mi(longitude)\n",
    "\n",
    "// Create year variable\n",
    "gen year = year(date)\n",
    "\n",
    "// Explore the data\n",
    "tab mi_latlong year, column\n",
    "\n",
    "\n",
    "// Fill in the missing Longditude and Latitude points\n",
    "\n",
    "// Sort the data in order\n",
    "sort onstreetname crossstreetname \n",
    "\n",
    "// If borough, zip, on street and cross street are the same \n",
    "// we use the latitude & longitude for the missing\n",
    "\n",
    "replace latitude = latitude[_n-1] if ///\n",
    "mi(latitude) & ///\n",
    "(borough == borough[_n-1]) & ///\n",
    "(zipcode == zipcode[_n-1]) & ///\n",
    "(onstreetname == onstreetname[_n-1]) & ///\n",
    "(crossstreetname ==  crossstreetname[_n-1])\n",
    "\n",
    "replace longitude = longitude[_n-1] if ///\n",
    "mi(longitude) & ///\n",
    "(borough == borough[_n-1]) & ///\n",
    "(zipcode == zipcode[_n-1]) & ///\n",
    "(onstreetname == onstreetname[_n-1]) & ///\n",
    "(crossstreetname ==  crossstreetname[_n-1])\n",
    "\n",
    "gen mi_latlong2 = mi(latitude) & mi(longitude)\n",
    "tab mi_latlong2 year, column\n",
    "\n",
    "// Decision to make\n",
    "// Do we drop observations that do not have coordinates, or geocode them through\n",
    "// other means?\n",
    "\n",
    "// Drop observations which are still missing\n",
    "drop if mi_latlong2 == 1\n",
    "\n",
    "// Out of boundaries\n",
    "drop if longitude < -74.5 | longitude > -73\n",
    "drop if latitude < 40 |  latitude > 41\n",
    "\n",
    "// Lets visualize the collisions\n",
    "twoway scatter latitude longitude, msymbol(o) msize(tiny)\n",
    "graph close\n",
    "\n",
    "// Create unique ID for unique longitude and latitude\n",
    "egen ID = group( latitude longitude)\n",
    "\n",
    "// Which intersections have the most collisions?\n",
    "\n",
    "// Which intersections have the most collisions in 2013?\n",
    "\n",
    "\n",
    "// Export for QGIS maping\n",
    "export delimited using \"..\\working_data\\NYPD_Motor_Vehicle_Collisions_clean.csv\", replace\n",
    "\n",
    "// Lets map the collisions out in QGIS\n",
    "\n",
    "\n",
    "display \"$S_DATE $S_TIME\"\n",
    "notes: \"Cleaned $S_DATE $S_TIME\"\n",
    "notes list\n",
    "save \"..\\working_data\\NYPD_Motor_Vehicle_Collisions_clean.dta\",replace\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Stata",
   "language": "stata",
   "name": "stata"
  },
  "language_info": {
   "codemirror_mode": "stata",
   "file_extension": ".do",
   "mimetype": "text/x-stata",
   "name": "stata",
   "version": "15.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
